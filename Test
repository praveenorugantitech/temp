@Service
@RequiredArgsConstructor
@Slf4j
public class EchoServiceImpl implements EchoService {

    private final AppConfig appConfig;
    private final AuthService authService;
    private final RestTemplate restTemplate;

    @Override
    public String echoTest() {
        String token = authService.getToken();

        try {
            String url = appConfig.getEchoUrl() + "?text=connected";
            HttpHeaders headers = new HttpHeaders();
            headers.set("Authorization", "Bearer " + token);
            HttpEntity<String> entity = new HttpEntity<>(headers);

            ResponseEntity<String> response = restTemplate.exchange(url, HttpMethod.GET, entity, String.class);

            if (response.getStatusCode() == HttpStatus.OK) {
                return response.getBody();
            } else {
                // Log the status and message, but skip further processing
                log.error("Received Error status: {} - {}", response.getStatusCode(), response.getBody());
                throw new EchoServiceException("Received Error status: " + response.getStatusCode() + " - " + response.getBody());
            }
        } catch (HttpClientErrorException e) {
            log.error("Failed to perform Echo connection: {}", e.getMessage());
            throw new EchoServiceException("Echo Connection Failed: " + e.getMessage());
        } catch (Exception e) {
            log.error("Failed to perform Echo connection: {}", e.getMessage());
            throw new EchoServiceException("Echo Connection Failed: " + e.getMessage());
        }
    }
}
